---
# yaml-language-server: $schema=https://schemas.ajgon.casa/other/docker-compose.json
services:
  borgmatic:
    image: ghcr.io/borgmatic-collective/borgmatic:2.1.1@sha256:fb2b879d208cbbbe53334367ec2c32c45bff0a1289f29c7d2ad1a9620117850f
    container_name: borgmatic
    restart: always
    env_file:
      - ./compose.env
      - ./override.env
    configs:
      - source: homelab
        target: /etc/borgmatic.d/homelab.yaml
      - source: legacy
        target: /etc/borgmatic.d/legacy.yaml
      - source: nas
        target: /etc/borgmatic.d/nas.yaml
    volumes:
      - /mnt/cache:/mnt/cache:ro
      - /mnt/tank:/mnt/tank:ro
      - "${PERIPHERY_ROOT_DIRECTORY:-/etc/komodo}/volumes/borgmatic/config:/config"

configs:
  homelab:
    file: ./config/homelab.yaml
  legacy:
    file: ./config/legacy.yaml
  nas:
    file: ./config/nas.yaml
