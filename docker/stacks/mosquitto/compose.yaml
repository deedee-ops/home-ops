---
# yamllint disable-line rule:line-length
# yaml-language-server: $schema=https://raw.githubusercontent.com/compose-spec/compose-spec/master/schema/compose-spec.json
services:
  mosquitto:
    image: public.ecr.aws/docker/library/eclipse-mosquitto:2.0.22@sha256:fd9982f5ed92a6c2a90805601d2275f8fbd7f2d47c4cb3836f7db0bdc7a91bec
    container_name: mosquitto
    user: "1000:1000"
    restart: unless-stopped
    env_file:
      - compose.env
    configs:
      - source: mosquitto
        target: /mosquitto/config/mosquitto.conf
    networks:
      - mosquitto
    volumes:
      - "${PERIPHERY_ROOT_DIRECTORY:-/etc/komodo}/volumes/mosquitto/data:/data"
    # security
    cap_drop:
      - all
    security_opt:
      - no-new-privileges
    read_only: true

configs:
  mosquitto:
    file: ./config/mosquitto.conf

networks:
  mosquitto:
    external: true
