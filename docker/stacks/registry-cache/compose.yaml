---
# yaml-language-server: $schema=https://schemas.ajgon.casa/other/docker-compose.json
services:
  registry-docker-io: &service
    image: public.ecr.aws/docker/library/registry:3.0.0@sha256:650406796a6a7c0c45d098cdcc4d6c5f5ae47c62e9fec489d287e2bfde38fe63
    container_name: registry-docker-io
    user: "1000:1000"
    restart: unless-stopped
    environment:
      REGISTRY_PROXY_REMOTEURL: https://registry-1.docker.io
      REGISTRY_STORAGE_S3_ROOTDIRECTORY: /docker/docker-io
    env_file:
      - registry.env
      - override.env
    ports:
      - "5000:5000"
    volumes:
      - "/etc/ssl/certs/ca-certificates.crt:/etc/ssl/certs/ca-certificates.crt"
    # security
    cap_drop:
      - all
    security_opt:
      - no-new-privileges
    read_only: true
  registry-codeberg-org:
    <<: *service
    container_name: registry-codeberg-org
    environment:
      REGISTRY_PROXY_REMOTEURL: https://codeberg.org
      REGISTRY_STORAGE_S3_ROOTDIRECTORY: /docker/codeberg-org
    ports:
      - "5001:5000"
  registry-ghcr-io:
    <<: *service
    container_name: registry-ghcr-io
    environment:
      REGISTRY_PROXY_REMOTEURL: https://ghcr.io
      REGISTRY_STORAGE_S3_ROOTDIRECTORY: /docker/ghcr-io
    ports:
      - "5002:5000"
  registry-gsoci-azurecr-io:
    <<: *service
    container_name: registry-gsoci-azurecr-io
    environment:
      REGISTRY_PROXY_REMOTEURL: https://gsoci.azurecr.io
      REGISTRY_STORAGE_S3_ROOTDIRECTORY: /docker/gsoci-azurecr-io
    ports:
      - "5003:5000"
  registry-mirror-gcr-io:
    <<: *service
    container_name: registry-mirror-gcr-io
    environment:
      REGISTRY_PROXY_REMOTEURL: https://mirror.gcr.io
      REGISTRY_STORAGE_S3_ROOTDIRECTORY: /docker/mirror-gcr-io
    ports:
      - "5004:5000"
  registry-quay-io:
    <<: *service
    container_name: registry-quay-io
    environment:
      REGISTRY_PROXY_REMOTEURL: https://quay.io
      REGISTRY_STORAGE_S3_ROOTDIRECTORY: /docker/quay-io
    ports:
      - "5005:5000"
  registry-registry-k8s-io:
    <<: *service
    container_name: registry-registry-k8s-io
    environment:
      REGISTRY_PROXY_REMOTEURL: https://registry.k8s.io
      REGISTRY_STORAGE_S3_ROOTDIRECTORY: /docker/registry-k8s-io
    ports:
      - "5006:5000"
