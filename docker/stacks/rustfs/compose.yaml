
---
# yamllint disable-line rule:line-length
# yaml-language-server: $schema=https://raw.githubusercontent.com/compose-spec/compose-spec/master/schema/compose-spec.json
services:
  rustfs:
    image: rustfs/rustfs:latest
    container_name: rustfs
    user: "1000:1000"
    restart: unless-stopped
    env_file:
      - ./compose.env
      - ./override.env
    volumes:
      - "${S3_DATA_DIRECTORY:-/s3}:/data"
    # security
    cap_drop:
      - all
    security_opt:
      - no-new-privileges
    read_only: true
    # traefik
    labels:
      traefik.enable: "true"
      # S3
      traefik.http.services.s3.loadbalancer.server.port: "9000"
      traefik.http.routers.s3.entrypoints: https
      traefik.http.routers.s3.rule: Host(`${S3_HOST}`)
      traefik.http.routers.s3.service: s3
      traefik.http.routers.s3.tls: true
      # Dashboard
      traefik.http.services.rustfs.loadbalancer.server.port: "9001"
      traefik.http.routers.rustfs.entrypoints: https
      traefik.http.routers.rustfs.rule: Host(`${S3_UI_HOST}`)
      traefik.http.routers.rustfs.service: rustfs
      traefik.http.routers.rustfs.tls: true
