---
# yaml-language-server: $schema=https://www.schemastore.org/traefik-v3.json
http:
  middlewares:
    redirect-http:
      redirectScheme:
        scheme: https
        permanent: true
  serversTransports:
    pocket-id:
      insecureSkipVerify: true
  services:
    pocket-id:
      loadBalancer:
        servers:
          - url: 'https://id.{{ env "ROOT_DOMAIN" }}'
            preservePath: true
        passHostHeader: false
        serversTransport: "pocket-id@file"
  routers:
    redirect-http:
      rule: 'PathPrefix(`/`)'
      service: prometheus@internal
      entryPoints:
        - http
      middlewares:
        - redirect-http
    pocket-id:
      priority: 100
      rule: 'Host(`pocket-id.security.svc.cluster.local`)'
      service: pocket-id
      entryPoints:
        - http
