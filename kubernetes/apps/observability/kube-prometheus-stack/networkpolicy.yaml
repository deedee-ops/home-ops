---
# yaml-language-server: $schema=https://schemas.ajgon.casa/cilium.io/ciliumnetworkpolicy_v2.json
apiVersion: "cilium.io/v2"
kind: CiliumNetworkPolicy
metadata:
  name: keda-egress-internal
specs:
  - endpointSelector:
      matchLabels:
        app.kubernetes.io/part-of: keda-operator
    egress:
      - toEndpoints:
          - matchLabels:
              app.kubernetes.io/part-of: keda-operator
---
# yaml-language-server: $schema=https://schemas.ajgon.casa/cilium.io/ciliumnetworkpolicy_v2.json
apiVersion: "cilium.io/v2"
kind: CiliumNetworkPolicy
metadata:
  name: alertmanager-egress-internal
specs:
  - endpointSelector:
      matchLabels:
        app.kubernetes.io/name: alertmanager
    egress:
      - toFQDNs:
          - matchName: hc-ping.com
        toPorts:
          - ports:
              - port: "443"
---
# yaml-language-server: $schema=https://schemas.ajgon.casa/cilium.io/ciliumnetworkpolicy_v2.json
apiVersion: cilium.io/v2
kind: CiliumNetworkPolicy
metadata:
  name: prometheus-egress-cluster
spec:
  endpointSelector:
    matchExpressions:
      - key: app.kubernetes.io/name
        operator: In
        values:
          - kube-prometheus-stack-prometheus-operator
          - kube-state-metrics
          - prometheus
  egress:
    - toEntities:
        - cluster
---
# yaml-language-server: $schema=https://schemas.ajgon.casa/cilium.io/ciliumnetworkpolicy_v2.json
apiVersion: "cilium.io/v2"
kind: CiliumNetworkPolicy
metadata:
  name: prometheus-egress-external
specs:
  - endpointSelector:
      matchLabels:
        app.kubernetes.io/name: prometheus
    egress:
      - toFQDNs:
          - matchName: nas.internal
        toPorts:
          - ports:
              - port: "9100"
              - port: "9633"
      - toFQDNs:
          - matchName: kvm.internal
        toPorts:
          - ports:
              - port: "80"
      - toFQDNs:
          - matchName: "traefik.${ROOT_DOMAIN}"
          - matchName: "vault.${ROOT_DOMAIN}"
        toPorts:
          - ports:
              - port: "443"
