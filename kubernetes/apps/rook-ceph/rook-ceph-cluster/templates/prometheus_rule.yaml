---
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  labels:
    prometheus: kube-prometheus-stack-prometheus
    role: alert-rules
  name: ceph-extra
spec:
  groups:
    - name: ceph-extra.rules
      rules:
        - alert: CephOSDHighWriteThroughput
          expr: sum(rate(ceph_osd_op_w_in_bytes[5m])) > 20971520
          for: 5m
          labels:
            severity: warning
          annotations:
            summary: Ceph OSDs are under high write pressure
            description: |-
              Ceph OSDs have a lot of writes. Use
              sum(rate(ceph_osd_op_w_in_bytes[5m])) > 20971520
              metric to find the culprit and investigate.
        - alert: CephOSDHighWriteIOPS
          expr: sum(rate(ceph_osd_op_w[10m])) > 40
          for: 5m
          labels:
            severity: warning
          annotations:
            summary: Ceph OSDs use a lot of IOPS
            description: |-
              Ceph OSDs have a lot of writes. Use
              sum(rate(ceph_osd_op_w_in_bytes[5m])) > 20971520
              metric to find the culprit and investigate.
