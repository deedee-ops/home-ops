---
# yaml-language-server: $schema=https://schemas.rzegocki.dev/monitoring.coreos.com/prometheusrule_v1.json
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: kyverno
spec:
  groups:
    - name: kyverno.rules
      rules:
        - alert: KyvernoPolicyFailed
          expr: |
            increase(kyverno_policy_results_total{rule_result="fail",rule_execution_cause="background_scan"}[1m]) > 0
          for: 1m
          labels:
            severity: warning
          annotations:
            description: |
              Some kyverno policies are failing. Check `PolicyReport` resource across all namespaces, to see which ones.
            summary: Kyverno policies failing.
